day: 11
operator: mv-expand
category: tabular
description: Expands multi-value arrays or property bags into separate rows
explanation: |
  mv-expand expands dynamic arrays or property bags so that each element becomes a separate row. This is useful when working with nested data structures.
  You can expand multiple columns simultaneously, and specify the type of the expanded column. Use mv-expand when you need to flatten nested data for analysis.
  Combine with mv-apply when you need to apply operators to each element before expansion.
examples:
  - query: | 
      DeviceProcessEvents
      | project DeviceName, ProcessCommandLine
      | extend Args = split(ProcessCommandLine, " ")
      | mv-expand Arg = Args
    description: >
      Splits command line into arguments and expands each argument into a separate row.
  - query: | 
      print "test"
      | extend IPs = dynamic(["192.168.1.1", "10.0.0.5", "172.16.0.10"])
      | mv-expand IP = IPs to typeof(string)
    description: >
      Expands an array of IP addresses, with each IP becoming a separate row.
  - query: | 
      DeviceNetworkEvents
      | summarize RemoteIPs = make_set(RemoteIP) by DeviceName
      | mv-expand RemoteIP = RemoteIPs
    description: >
      Creates a set of unique remote IPs per device, then expands them back into individual rows for further analysis.

challenge: |
  Using the DeviceProcessEvents sample dataset answer the following question:

  For processes where FileName is 'cmd.exe', split the ProcessCommandLine by spaces into an array of arguments. Then expand the array so each argument appears in its own row. How many rows contain the argument '/c'?

  ```
      // ----------------------------
    // DemoDeviceProcessEvents
    // ----------------------------
    let DemoDeviceProcessEvents = externaldata(
        AccountDomain:string,
        AccountName:string,
        AccountObjectId:string,
        AccountSid:string,
        AccountUpn:string,
        ActionType:string,
        AdditionalFields:dynamic,
        AppGuardContainerId:string,
        DeviceId:string,
        DeviceName:string,
        FileName:string,
        FolderPath:string,
        FileSize:long,
        InitiatingProcessAccountDomain:string,
        InitiatingProcessAccountName:string,
        InitiatingProcessAccountObjectId:string,
        InitiatingProcessAccountSid:string,
        InitiatingProcessAccountUpn:string,
        InitiatingProcessCommandLine:string,
        InitiatingProcessFileName:string,
        InitiatingProcessFolderPath:string,
        InitiatingProcessId:long,
        InitiatingProcessIntegrityLevel:string,
        InitiatingProcessLogonId:long,
        InitiatingProcessMD5:string,
        InitiatingProcessParentFileName:string,
        InitiatingProcessParentId:long,
        InitiatingProcessSHA1:string,
        InitiatingProcessSHA256:string,
        InitiatingProcessTokenElevation:string,
        InitiatingProcessFileSize:long,
        InitiatingProcessVersionInfoCompanyName:string,
        InitiatingProcessVersionInfoProductName:string,
        InitiatingProcessVersionInfoProductVersion:string,
        InitiatingProcessVersionInfoInternalFileName:string,
        InitiatingProcessVersionInfoOriginalFileName:string,
        InitiatingProcessVersionInfoFileDescription:string,
        LogonId:long,
        MD5:string,
        MachineGroup:string,
        ProcessCommandLine:string,
        ProcessCreationTime:datetime,
        ProcessId:long,
        ProcessIntegrityLevel:string,
        ProcessTokenElevation:string,
        ProcessVersionInfoCompanyName:string,
        ProcessVersionInfoProductName:string,
        ProcessVersionInfoProductVersion:string,
        ProcessVersionInfoInternalFileName:string,
        ProcessVersionInfoOriginalFileName:string,
        ProcessVersionInfoFileDescription:string,
        InitiatingProcessSignerType:string,
        InitiatingProcessSignatureStatus:string,
        ReportId:long,
        SHA1:string,
        SHA256:string,
        TimeGenerated:datetime,
        Timestamp:datetime,
        InitiatingProcessParentCreationTime:datetime,
        InitiatingProcessCreationTime:datetime,
        CreatedProcessSessionId:long,
        IsProcessRemoteSession:bool,
        ProcessRemoteSessionDeviceName:string,
        ProcessRemoteSessionIP:string,
        InitiatingProcessSessionId:long,
        IsInitiatingProcessRemoteSession:bool,
        InitiatingProcessRemoteSessionDeviceName:string,
        InitiatingProcessRemoteSessionIP:string,
        InitiatingProcessUniqueId:string,
        ProcessUniqueId:string,
        SourceSystem:string,
        Type:string
    )
    ["https://raw.githubusercontent.com/tom564/100_days_kql_2026/refs/heads/main/Datasets/DemoDeviceProcessEvents.csv.gz"]
    with(format="csv", ignoreFirstRecord=true);
    DemoDeviceProcessEvents
  ```

answer: |
  // Run this KQL replacing <Your Answer Here> with your answer to validate, 
  let answer = "<Your Answer Here>";
  let repo = "tom564";
  let answer_hash = "60a6b1c9cd8422c09970c3e9f1082c81ce05867ba4ace808c5f3b003572b409c";
  let attempt = hash_sha256(strcat(answer, repo));
  print iff(attempt == answer_hash, "Correct", "Incorrect")