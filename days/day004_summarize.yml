day: 4
operator: summarize
category: tabular
description: Aggregates data into groups
explanation: |
  summarize produces a table that aggregates the content of the input table using aggregation functions like count(), sum(), avg(), min(), max(), etc.
  Use the 'by' clause to group results by one or more columns. Without a 'by' clause, summarize returns a single row with aggregated values across all input rows.
examples:
  - query: | 
      DeviceProcessEvents
      | summarize Count = count() by DeviceName
    description: >
      Counts the number of process events for each device.
  - query: | 
      DeviceNetworkEvents
      | summarize TotalBytes = sum(SentBytes + ReceivedBytes) by RemoteIP
    description: >
      Calculates the total bytes sent and received for each remote IP address.
  - query: | 
      SecurityEvent
      | summarize EventCount = count(), FirstSeen = min(TimeGenerated), LastSeen = max(TimeGenerated) by EventID
    description: >
      Aggregates security events by EventID, showing count and time range.

challenge: |
  Using the DeviceProcessEvents sample dataset answer the following question:

  What is the total count of events where the InitiatingProcessFileName is 'powershell.exe' grouped by DeviceName? Return the DeviceName with the highest count.

  ```
    let DemoDeviceProcessEvents = externaldata(
        AccountDomain:string,
        AccountName:string,
        AccountObjectId:string,
        AccountSid:string,
        AccountUpn:string,
        ActionType:string,
        AdditionalFields:dynamic,
        AppGuardContainerId:string,
        DeviceId:string,
        DeviceName:string,
        FileName:string,
        FolderPath:string,
        FileSize:long,
        InitiatingProcessAccountDomain:string,
        InitiatingProcessAccountName:string,
        InitiatingProcessAccountObjectId:string,
        InitiatingProcessAccountSid:string,
        InitiatingProcessAccountUpn:string,
        InitiatingProcessCommandLine:string,
        InitiatingProcessFileName:string,
        InitiatingProcessFolderPath:string,
        InitiatingProcessId:long,
        InitiatingProcessIntegrityLevel:string,
        InitiatingProcessLogonId:long,
        InitiatingProcessMD5:string,
        InitiatingProcessParentFileName:string,
        InitiatingProcessParentId:long,
        InitiatingProcessSHA1:string,
        InitiatingProcessSHA256:string,
        InitiatingProcessTokenElevation:string,
        InitiatingProcessFileSize:long,
        InitiatingProcessVersionInfoCompanyName:string,
        InitiatingProcessVersionInfoProductName:string,
        InitiatingProcessVersionInfoProductVersion:string,
        InitiatingProcessVersionInfoInternalFileName:string,
        InitiatingProcessVersionInfoOriginalFileName:string,
        InitiatingProcessVersionInfoFileDescription:string,
        LogonId:long,
        MD5:string,
        MachineGroup:string,
        ProcessCommandLine:string,
        ProcessCreationTime:datetime,
        ProcessId:long,
        ProcessIntegrityLevel:string,
        ProcessTokenElevation:string,
        ProcessVersionInfoCompanyName:string,
        ProcessVersionInfoProductName:string,
        ProcessVersionInfoProductVersion:string,
        ProcessVersionInfoInternalFileName:string,
        ProcessVersionInfoOriginalFileName:string,
        ProcessVersionInfoFileDescription:string,
        InitiatingProcessSignerType:string,
        InitiatingProcessSignatureStatus:string,
        ReportId:long,
        SHA1:string,
        SHA256:string,
        TimeGenerated:datetime,
        Timestamp:datetime,
        InitiatingProcessParentCreationTime:datetime,
        InitiatingProcessCreationTime:datetime,
        CreatedProcessSessionId:long,
        IsProcessRemoteSession:bool,
        ProcessRemoteSessionDeviceName:string,
        ProcessRemoteSessionIP:string,
        InitiatingProcessSessionId:long,
        IsInitiatingProcessRemoteSession:bool,
        InitiatingProcessRemoteSessionDeviceName:string,
        InitiatingProcessRemoteSessionIP:string,
        InitiatingProcessUniqueId:string,
        ProcessUniqueId:string,
        SourceSystem:string,
        Type:string
    )
    ["https://raw.githubusercontent.com/tom564/100_days_kql_2026/refs/heads/main/Datasets/DemoDeviceProcessEvents.csv.gz"]
    with(format="csv", ignoreFirstRecord=true);
    DemoDeviceProcessEvents
  ```

answer: |
  // Run this KQL replacing <Your Answer Here> with your answer to validate, 
  let answer = "<Your Answer Here>";
  let repo = "tom564";
  let answer_hash = "ff1096630a764b1b8359f89b57100ecacf294dabe0a00a6f9bcdcbc86a85a374";
  let attempt = hash_sha256(strcat(answer, repo));
  print iff(attempt == answer_hash, "Correct", "Incorrect")